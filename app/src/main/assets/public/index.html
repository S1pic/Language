<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>LanguagePod: South African Languages</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;500;600;700&display=swap');
        html, body { height: 100%; }
        body { font-family: 'Poppins', sans-serif; }

        /* Hide all page sections by default, show only the active one */
        .page-section { display: none; }
        .page-section.active { display: flex; flex-direction: column; height: 100%; }

        /* Flashcard flip animation */
        .flashcard-inner { transition: transform 0.6s; transform-style: preserve-3d; }
        .flashcard.flipped .flashcard-inner { transform: rotateY(180deg); }
        .flashcard-front, .flashcard-back { -webkit-backface-visibility: hidden; backface-visibility: hidden; }
        .flashcard-back { transform: rotateY(180deg); }

        /* Adjust main padding for fixed navigation */
        main { padding-bottom: 80px; flex-grow: 1; display: flex; flex-direction: column; } /* For mobile nav */
        @media (min-width: 768px) { /* md breakpoint */
            main { padding-left: 80px; padding-bottom: 0; }
        }

        /* Ensure header takes fixed height */
        main > header { flex-shrink: 0; }
        /* The active page-section will handle its own internal scrolling */
    </style>
</head>
<body class="bg-gray-50 text-gray-800">

<!-- Mobile Navigation -->
<nav class="md:hidden fixed bottom-0 w-full bg-white shadow-lg z-50">
    <div class="flex justify-around items-center py-3">
        <a href="#home-section" class="nav-link flex flex-col items-center text-indigo-600" data-title="Dashboard">
            <i class="fas fa-home text-xl"></i><span class="text-xs mt-1">Home</span>
        </a>
        <a href="#learn-section" class="nav-link flex flex-col items-center text-gray-500" data-title="Learn">
            <i class="fas fa-book-open text-xl"></i><span class="text-xs mt-1">Learn</span>
        </a>
        <a href="#speak-section" class="nav-link flex flex-col items-center text-gray-500" data-title="Speak">
            <i class="fas fa-microphone text-xl"></i><span class="text-xs mt-1">Speak</span>
        </a>
        <a href="#profile-section" class="nav-link flex flex-col items-center text-gray-500" data-title="Profile">
            <i class="fas fa-user text-xl"></i><span class="text-xs mt-1">Profile</span>
        </a>
    </div>
</nav>

<!-- Desktop Navigation -->
<nav class="hidden md:flex fixed top-0 left-0 h-full w-20 bg-white shadow-lg flex-col items-center py-8 z-50">
    <div class="mb-10"><i class="fas fa-language text-3xl text-indigo-600"></i></div>
    <a href="#home-section" class="nav-link my-4 text-indigo-600" data-title="Dashboard"><i class="fas fa-home text-xl"></i></a>
    <a href="#learn-section" class="nav-link my-4 text-gray-500" data-title="Learn"><i class="fas fa-book-open text-xl"></i></a>
    <a href="#speak-section" class="nav-link my-4 text-gray-500" data-title="Speak"><i class="fas fa-microphone text-xl"></i></a>
    <a href="#profile-section" class="nav-link my-4 text-gray-500" data-title="Profile"><i class="fas fa-user text-xl"></i></a>
</nav>

<!-- Main Content -->
<main>
    <header class="bg-indigo-600 text-white p-4 md:p-6">
        <div class="flex justify-between items-center">
            <h1 id="header-title" class="text-xl md:text-2xl font-bold">Dashboard</h1>
        </div>
    </header>

    <!-- Home Section -->
    <section id="home-section" class="page-section p-4 md:p-6 active">
        <div class="bg-white rounded-xl shadow-md p-6 mb-6">
             <div class="flex justify-between items-center mb-4">
                <h2 class="text-lg font-semibold">Welcome back, Skye!!!</h2>
                <div class="flex items-center bg-indigo-100 text-indigo-800 px-3 py-1 rounded-full"><i class="fas fa-fire mr-1"></i><span class="text-sm font-medium">7 day streak</span></div>
            </div>
            <div>
                <h3 class="text-sm text-gray-500">Current language</h3>
                <p id="current-language" class="font-semibold">isiZulu</p>
            </div>
        </div>

        <div id="daily-challenge-card" class="bg-gradient-to-r from-indigo-500 to-purple-600 rounded-xl shadow-md p-6 text-white mb-6">
            <h2 class="text-lg font-semibold mb-2">Daily Challenge</h2>
            <p class="text-sm mb-4">Complete today's challenge to earn bonus XP!</p>
            <button id="start-challenge-btn" class="bg-white text-indigo-600 font-semibold py-2 px-4 rounded-lg w-full">Start Challenge</button>
        </div>

        <h2 class="text-lg font-semibold mb-4">Continue Learning</h2>
        <div id="continue-learning-container" class="space-y-4">
            <button data-lesson-type="Greetings" class="w-full bg-white rounded-xl shadow-md p-6 text-left flex items-center"><div class="w-12 h-12 rounded-lg bg-indigo-100 flex items-center justify-center mr-4"><i class="fas fa-hand-sparkles text-indigo-600 text-xl"></i></div><div><h3 class="font-medium">Greetings</h3><p class="text-sm text-gray-500">Learn common courtesies.</p></div></button>
            <button data-lesson-type="Introductions" class="w-full bg-white rounded-xl shadow-md p-6 text-left flex items-center"><div class="w-12 h-12 rounded-lg bg-indigo-100 flex items-center justify-center mr-4"><i class="fas fa-user-friends text-indigo-600 text-xl"></i></div><div><h3 class="font-medium">Introductions</h3><p class="text-sm text-gray-500">Introduce yourself and others.</p></div></button>
        </div>
    </section>

    <!-- Learn Section -->
    <section id="learn-section" class="page-section p-4 md:p-6 hidden">
        <h2 class="text-lg font-semibold mb-4">Learn a Language</h2>
        <div id="learn-language-grid" class="grid grid-cols-2 md:grid-cols-3 gap-4"></div>
    </section>

    <!-- Speak Section -->
    <section id="speak-section" class="page-section p-4 md:p-6 hidden">
        <h2 class="text-lg font-semibold mb-4">Quick Practice</h2>
        <div class="grid grid-cols-2 gap-4">
            <div class="bg-white rounded-xl shadow-md p-4 flex flex-col items-center"><div class="w-12 h-12 rounded-full bg-indigo-100 flex items-center justify-center mb-3"><i class="fas fa-volume-up text-indigo-600 text-xl"></i></div><h3 class="font-medium text-sm mb-1">Listening</h3></div>
            <div class="bg-white rounded-xl shadow-md p-4 flex flex-col items-center"><div class="w-12 h-12 rounded-full bg-indigo-100 flex items-center justify-center mb-3"><i class="fas fa-microphone text-indigo-600 text-xl"></i></div><h3 class="font-medium text-sm mb-1">Speaking</h3></div>
        </div>
    </section>

    <!-- Profile Section -->
    <section id="profile-section" class="page-section p-4 md:p-6 hidden">
        <h2 class="text-lg font-semibold mb-4">Profile</h2>
        <div class="bg-white rounded-xl shadow-md p-6 text-center"><p>Profile content goes here.</p></div>
    </section>

    <!-- Lesson List View (sub-view of Learn) -->
    <section id="lesson-list-view" class="page-section hidden"></section>

    <!-- Lesson Detail View (sub-view of Learn) -->
    <section id="lesson-detail-view" class="page-section hidden"></section>

    <!-- Flashcard Modal -->
    <div id="flashcard-modal" class="fixed inset-0 bg-black bg-opacity-70 flex items-center justify-center z-50" style="display: none;">
        <div class="bg-white rounded-xl w-full max-w-md mx-4 p-6">
            <div class="flex justify-between items-center mb-4"><h2 id="flashcard-title" class="text-xl font-bold">Flashcards</h2><button id="close-flashcard-modal" class="text-gray-500 hover:text-gray-800"><i class="fas fa-times text-xl"></i></button></div>
            <div id="flashcard-container" class="perspective-1000 flashcard"><div class="flashcard-inner relative w-full h-48"><div id="flashcard-front" class="flashcard-front absolute w-full h-full bg-indigo-100 rounded-lg flex flex-col justify-center items-center p-4 text-center"></div><div id="flashcard-back" class="flashcard-back absolute w-full h-full bg-indigo-200 rounded-lg flex flex-col justify-center items-center p-4 text-center"></div></div></div>
            <div class="text-center my-4 text-sm text-gray-500" id="flashcard-progress"></div>
            <div class="flex justify-center mb-4"><button id="flip-flashcard-btn" class="bg-indigo-600 text-white font-semibold py-2 px-8 rounded-lg">Flip</button></div>
            <div class="flex justify-between items-center"><button id="prev-flashcard-btn" class="p-2 text-gray-500 hover:text-indigo-600"><i class="fas fa-arrow-left text-2xl"></i></button><button id="next-flashcard-btn" class="p-2 text-gray-500 hover:text-indigo-600"><i class="fas fa-arrow-right text-2xl"></i></button></div>
        </div>
    </div>

    <!-- Daily Challenge Modal -->
    <div id="challenge-modal" class="fixed inset-0 bg-black bg-opacity-70 flex items-center justify-center z-50" style="display: none;">
        <div class="bg-white rounded-xl w-full max-w-md mx-4 p-6">
            <div class="flex justify-between items-center mb-4"><h2 class="text-xl font-bold">Daily Challenge</h2><button id="close-challenge-modal" class="text-gray-500 hover:text-gray-800"><i class="fas fa-times text-xl"></i></button></div>
            <p class="text-sm text-gray-600 mb-2">What is the meaning of this phrase?</p>
            <div class="bg-gray-100 rounded-lg p-4 mb-6 text-center"><p id="challenge-phrase" class="text-2xl font-bold text-gray-900"></p></div>
            <div id="challenge-options" class="space-y-3"></div>
            <div id="challenge-feedback" class="mt-4"></div>
            <button id="next-challenge-btn" class="hidden mt-4 bg-indigo-600 text-white font-semibold py-2 px-4 rounded-lg w-full">Next</button>
        </div>
    </div>

</main>

<script>
    document.addEventListener('DOMContentLoaded', () => {
        // --- State Management ---
        let currentLanguage = 'isiZulu';
        let allLanguageData = {};
        let currentFlashcards = [];
        let currentCardIndex = 0;
        let correctChallengeAnswer = '';

        // --- DOM Elements ---
        const pageSections = document.querySelectorAll('.page-section');
        const lessonListContainer = document.getElementById('lesson-list-view');
        const lessonDetailContainer = document.getElementById('lesson-detail-view');
        const currentLanguageEl = document.getElementById('current-language');
        const continueLearningContainer = document.getElementById('continue-learning-container');
        const learnLanguageGrid = document.getElementById('learn-language-grid');
        const flashcardModal = document.getElementById('flashcard-modal');
        const challengeModal = document.getElementById('challenge-modal');
        const navLinks = document.querySelectorAll('.nav-link');
        const headerTitle = document.getElementById('header-title');

        const languages = [
            { name: 'isiZulu', file: 'isizulu.csv', color: 'bg-red-500', description: "South Africa's most widely spoken home language." },
            { name: 'Xitsonga', file: 'xitsonga.csv', color: 'bg-blue-500', description: "Primarily spoken in Limpopo and Mpumalanga." },
            { name: 'Tshivenda', file: 'tshivenda.csv', color: 'bg-yellow-600', description: "A unique language spoken in northern South Africa." }
        ];

        // --- Data Loading ---
        async function loadLanguageData(filePath) {
            try {
                const response = await fetch(filePath);
                if (!response.ok) throw new Error(`HTTP error! status: ${response.status}`);
                const csvText = await response.text();
                const rows = csvText.trim().split('\n').slice(1);
                return rows.map(row => {
                    const columns = row.split(',');
                    return { lesson: columns[0]?.trim(), native: columns[1]?.trim(), english: columns[2]?.trim(), pronunciation: columns[3]?.trim() };
                }).filter(r => r.lesson && r.native && r.english);
            } catch (error) { console.error('Error loading language data:', error); return []; }
        }

        // --- UI & App Logic ---
        function showPage(pageId) {
            pageSections.forEach(section => section.classList.remove('active'));
            document.getElementById(pageId).classList.add('active');
            const navLink = document.querySelector(`.nav-link[href="#${pageId}"]`);
            if (navLink) {
                headerTitle.textContent = navLink.dataset.title;
                navLinks.forEach(l => l.classList.replace('text-indigo-600', 'text-gray-500'));
                navLink.classList.replace('text-gray-500', 'text-indigo-600');
            }
        }

        function displayLearnLanguages() {
            learnLanguageGrid.innerHTML = '';
            languages.forEach(lang => {
                learnLanguageGrid.innerHTML += `
                    <div class="bg-white rounded-xl shadow-md overflow-hidden cursor-pointer" data-lang-learn="${lang.name}">
                        <div class="h-24 ${lang.color} flex items-center justify-center"><span class="text-white font-bold text-xl">${lang.name}</span></div>
                        <div class="p-4">
                            <h3 class="text-lg font-semibold mb-2">${lang.name}</h3>
                            <button class="bg-indigo-600 text-white font-semibold py-2 px-4 rounded-lg w-full text-sm">Start Learning</button>
                        </div>
                    </div>`;
            });
        }

        function renderFlashcard() {
            const card = currentFlashcards[currentCardIndex];
            document.getElementById('flashcard-front').innerHTML = `<h3 class="text-2xl font-bold">${card.native}</h3>`;
            document.getElementById('flashcard-back').innerHTML = `<h3 class="text-2xl font-bold">${card.english}</h3><p class="text-md text-gray-600 mt-2">${card.pronunciation || ''}</p>`;
            document.getElementById('flashcard-progress').textContent = `Card ${currentCardIndex + 1} of ${currentFlashcards.length}`;
            document.getElementById('flashcard-container').classList.remove('flipped');
        }

        function showFlashcardModal(cards, title) {
            currentFlashcards = cards;
            currentCardIndex = 0;
            document.getElementById('flashcard-title').textContent = title;
            renderFlashcard();
            flashcardModal.style.display = 'flex'; // Use direct style for visibility
        }

        function showLessonListPage(langName) {
            const lessonData = allLanguageData[langName];
            const uniqueLessons = [...new Set(lessonData.map(item => item.lesson))];

            let lessonListHTML = `<div class="p-4 md:p-6 flex flex-col h-full"><button id="back-to-learn-grid" class="mb-4 text-indigo-600 font-semibold flex-shrink-0"><i class="fas fa-arrow-left mr-2"></i>Back to Languages</button><h2 class="text-2xl font-bold mb-4 flex-shrink-0">${langName} Lessons</h2><div class="space-y-4 flex-grow overflow-y-auto">`;
            uniqueLessons.forEach(lessonName => {
                lessonListHTML += `<button data-lesson-name="${lessonName}" data-lang-name="${langName}" class="lesson-select-btn w-full bg-white rounded-xl shadow-md p-6 text-left flex items-center"><div class="w-12 h-12 rounded-lg bg-indigo-100 flex items-center justify-center mr-4"><i class="fas fa-book text-indigo-600 text-xl"></i></div><div><h3 class="font-medium">${lessonName}</h3></div></button>`;
            });
            lessonListHTML += `</div></div>`;

            lessonListContainer.innerHTML = lessonListHTML;
            showPage('lesson-list-view');
        }

        function showLessonDetail(langName, lessonName) {
            const lessonData = allLanguageData[langName].filter(item => item.lesson === lessonName);
            
            let detailHTML = `<div class="p-4 md:p-6 flex flex-col h-full"><button id="back-to-lesson-list" class="mb-4 text-indigo-600 font-semibold flex-shrink-0"><i class="fas fa-arrow-left mr-2"></i>Back to Lessons</button><h2 class="text-2xl font-bold mb-4 flex-shrink-0">${lessonName}</h2><div class="flex-grow overflow-y-auto space-y-2">`;
            lessonData.forEach(phrase => {
                detailHTML += `<div class="bg-white rounded-lg p-4 shadow"><p class="font-semibold text-lg">${phrase.native}</p><p class="text-gray-600">${phrase.english}</p></div>`;
            });
            detailHTML += `</div></div>`;

            lessonDetailContainer.innerHTML = detailHTML;
            showPage('lesson-detail-view');
        }

        function startDailyChallenge() {
            const challengeData = allLanguageData[currentLanguage];
            if (!challengeData || challengeData.length < 3) { alert("Not enough data for a challenge!"); return; }
            const questionPhrase = challengeData[Math.floor(Math.random() * challengeData.length)];
            correctChallengeAnswer = questionPhrase.english;
            let wrongAnswers = [];
            while (wrongAnswers.length < 2) {
                const randomPhrase = challengeData[Math.floor(Math.random() * challengeData.length)];
                if (randomPhrase.english !== correctChallengeAnswer && !wrongAnswers.includes(randomPhrase.english)) {
                    wrongAnswers.push(randomPhrase.english);
                }
            }
            const choices = [correctChallengeAnswer, ...wrongAnswers].sort(() => Math.random() - 0.5);
            document.getElementById('challenge-phrase').textContent = questionPhrase.native;
            const optionsContainer = document.getElementById('challenge-options');
            optionsContainer.innerHTML = '';
            choices.forEach(choice => { optionsContainer.innerHTML += `<button class="challenge-option w-full bg-gray-100 hover:bg-gray-200 p-3 rounded-lg">${choice}</button>`; });
            document.getElementById('challenge-feedback').innerHTML = '';
            document.getElementById('next-challenge-btn').classList.add('hidden');
            challengeModal.style.display = 'flex'; // Use direct style for visibility
        }

        // --- Event Listeners ---
        document.getElementById('start-challenge-btn').addEventListener('click', startDailyChallenge);
        document.getElementById('close-challenge-modal').addEventListener('click', () => challengeModal.style.display = 'none'); // Use direct style for visibility
        document.getElementById('next-challenge-btn').addEventListener('click', startDailyChallenge);
        document.getElementById('challenge-options').addEventListener('click', (e) => {
            if (e.target.classList.contains('challenge-option')) {
                const selectedAnswer = e.target.textContent;
                document.querySelectorAll('.challenge-option').forEach(btn => btn.disabled = true);
                if (selectedAnswer === correctChallengeAnswer) {
                    e.target.classList.remove('bg-gray-100');
                    e.target.classList.add('bg-green-500', 'text-white');
                } else {
                    e.target.classList.remove('bg-gray-100');
                    e.target.classList.add('bg-red-500', 'text-white');
                    document.getElementById('challenge-feedback').innerHTML = `<p class="text-red-600 font-semibold mt-2">Correct answer: ${correctChallengeAnswer}</p>`;
                }
                document.getElementById('next-challenge-btn').classList.remove('hidden');
            }
        });

        navLinks.forEach(link => {
            link.addEventListener('click', (e) => {
                e.preventDefault();
                const targetId = link.getAttribute('href').substring(1);
                showPage(targetId);
            });
        });

        continueLearningContainer.addEventListener('click', (e) => {
            const button = e.target.closest('[data-lesson-type]');
            if (button) {
                const lessonType = button.dataset.lessonType;
                const lessonData = allLanguageData[currentLanguage];
                const cards = lessonData.filter(l => l.lesson === lessonType);
                if (cards.length > 0) showFlashcardModal(cards, `${currentLanguage} - ${lessonType}`);
            }
        });

        learnLanguageGrid.addEventListener('click', (e) => {
            const card = e.target.closest('[data-lang-learn]');
            if (card) {
                const langName = card.dataset.langLearn;
                currentLanguage = langName;
                currentLanguageEl.textContent = langName;
                showLessonListPage(langName);
            }
        });

        lessonListContainer.addEventListener('click', (e) => {
            const lessonBtn = e.target.closest('.lesson-select-btn');
            const backToLearnGridBtn = e.target.closest('#back-to-learn-grid');

            if (lessonBtn) {
                const langName = lessonBtn.dataset.langName;
                const lessonName = lessonBtn.dataset.lessonName;
                showLessonDetail(langName, lessonName);
            } else if (backToLearnGridBtn) {
                showPage('learn-section');
            }
        });

        lessonDetailContainer.addEventListener('click', (e) => {
            const backToLessonListBtn = e.target.closest('#back-to-lesson-list');
            if (backToLessonListBtn) {
                showLessonListPage(currentLanguage);
            }
        });

        // Flashcard Modal Controls
        document.getElementById('close-flashcard-modal').addEventListener('click', () => flashcardModal.style.display = 'none'); // Use direct style for visibility
        document.getElementById('flip-flashcard-btn').addEventListener('click', () => document.getElementById('flashcard-container').classList.toggle('flipped'));
        document.getElementById('next-flashcard-btn').addEventListener('click', () => {
            if (currentCardIndex < currentFlashcards.length - 1) { currentCardIndex++; renderFlashcard(); }
        });
        document.getElementById('prev-flashcard-btn').addEventListener('click', () => {
            if (currentCardIndex > 0) { currentCardIndex--; renderFlashcard(); }
        });

        // --- Initial Load ---
        async function initializeApp() {
            for (const lang of languages) {
                allLanguageData[lang.name] = await loadLanguageData(lang.file);
            }
            currentLanguageEl.textContent = currentLanguage;
            displayLearnLanguages();
            showPage('home-section'); // Show home section by default
        }

        initializeApp();
    });
</script>
</body>
</html>
